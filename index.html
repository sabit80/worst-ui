<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ChronoCatch - High Performance Alarm UI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6C63FF;
            --secondary: #FF6584;
            --accent: #43D9AD;
            --glass: rgba(255, 255, 255, 0.12);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
            user-select: none;
            touch-action: none; /* Critical for multi-touch dragging */
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            height: 100vh;
            overflow: hidden;
            color: white;
        }

        /* --- UI Elements --- */
        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .game-header {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 40px;
            z-index: 1000;
        }

        .time-display {
            font-size: 3.5rem;
            font-weight: 900;
            letter-spacing: 4px;
            font-variant-numeric: tabular-nums;
        }

        /* Jars */
        .draggable-jar {
            position: absolute;
            width: 140px;
            height: 200px;
            cursor: grab;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            touch-action: none; /* Prevents browser intercepting drag */
        }

        .jar-body {
            width: 120px;
            height: 160px;
            background: rgba(255, 255, 255, 0.08);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: none;
            border-radius: 0 0 50px 50px;
            position: relative;
            overflow: hidden;
        }

        .jar-label {
            margin-bottom: 8px;
            padding: 4px 16px;
            border-radius: 20px;
            font-weight: 900;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .label-hour { background: var(--secondary); }
        .label-minute { background: var(--accent); color: #1a1a2e; }

        .jar-counter {
            position: absolute;
            bottom: -15px;
            background: white;
            color: #1a1a2e;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .jar-content {
            position: absolute;
            bottom: 0;
            width: 100%;
            display: flex;
            flex-wrap: wrap-reverse;
            justify-content: center;
            padding: 10px;
            gap: 2px;
            height: 100%;
        }

        /* Balls */
        .ball {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            box-shadow: inset -3px -3px 6px rgba(0,0,0,0.3);
        }

        .ball-hour { background: radial-gradient(circle at 30% 30%, #ff8fa3, #ff4772); }
        .ball-minute { background: radial-gradient(circle at 30% 30%, #7bf1cc, #2bcfa5); }

        .falling-ball {
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            z-index: 50;
            will-change: transform;
        }

        /* Screens */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            background: #1a1a2e;
        }

        .hidden { display: none; }

        .btn {
            padding: 18px 40px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 900;
            text-transform: uppercase;
            transition: 0.3s;
            margin-top: 20px;
        }

        .btn-primary { background: white; color: var(--primary); }
        .btn-primary:hover { transform: scale(1.05); }

        .controls {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 1000;
        }

        @keyframes pop {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        .pop-anim { animation: pop 0.4s ease-out forwards; }

    </style>
</head>
<body>

    <div id="start-screen" class="screen">
        <h1 style="font-size: 3.5rem; margin-bottom: 10px;">ChronoCatch</h1>
        <p style="color: #888; margin-bottom: 30px;">Catch the time. Don't be late.</p>
        <button class="btn btn-primary" onclick="startGame()">Start Game</button>
    </div>

    <div id="game-ui" class="hidden">
        <div class="game-header glass-panel">
            <span class="time-display" id="clock">00:00</span>
        </div>

        <div id="game-area"></div>

        <div class="draggable-jar" id="jar-hour" style="top: 250px; left: 100px;">
            <div class="jar-label label-hour">Hours</div>
            <div class="jar-body"><div class="jar-content" id="content-hour"></div></div>
            <div class="jar-counter" id="count-hour">0</div>
        </div>

        <div class="draggable-jar" id="jar-minute" style="top: 250px; right: 100px;">
            <div class="jar-label label-minute">Minutes</div>
            <div class="jar-body"><div class="jar-content" id="content-minute"></div></div>
            <div class="jar-counter" id="count-minute">0</div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" style="background: var(--secondary); color: white;" onclick="resetGame()">Reset</button>
            <button class="btn btn-primary" style="background: var(--accent); color: #1a1a2e;" onclick="finishGame()">Set Alarm</button>
        </div>
    </div>

    <div id="result-screen" class="screen hidden">
        <h1 style="color: var(--accent);">Alarm Set!</h1>
        <div class="glass-panel" style="padding: 20px 60px; margin: 20px 0;">
            <span class="time-display" id="final-time">00:00</span>
        </div>
        <button class="btn btn-primary" onclick="location.reload()">Reset Everything</button>
    </div>

    <script>
        const state = {
            hours: 0,
            minutes: 0,
            isPlaying: false,
            balls: [], 
            lastFrameTime: 0,
            spawnTimer: 0
        };

        const els = {
            hourJar: document.getElementById('jar-hour'),
            minuteJar: document.getElementById('jar-minute'),
            hourContent: document.getElementById('content-hour'),
            minuteContent: document.getElementById('content-minute'),
            hourCount: document.getElementById('count-hour'),
            minuteCount: document.getElementById('count-minute'),
            clock: document.getElementById('clock'),
            gameArea: document.getElementById('game-area')
        };

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            state.isPlaying = true;
            resetGame(); // Ensure zero start
            
            initDraggable(els.hourJar);
            initDraggable(els.minuteJar);
            requestAnimationFrame(gameLoop);
        }

        function gameLoop(timestamp) {
            if (!state.isPlaying) return;
            const deltaTime = timestamp - state.lastFrameTime;
            state.lastFrameTime = timestamp;

            state.spawnTimer += deltaTime;
            if (state.spawnTimer > 500) { 
                spawnBall();
                state.spawnTimer = 0;
            }

            updateBalls();
            requestAnimationFrame(gameLoop);
        }

        // --- Multi-Touch Multi-Jar Support ---
        function initDraggable(el) {
            let offsetX, offsetY, activeId = null;

            el.addEventListener('pointerdown', (e) => {
                if (activeId !== null) return;
                activeId = e.pointerId;
                el.setPointerCapture(e.pointerId);
                
                const rect = el.getBoundingClientRect();
                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;
                el.style.zIndex = 1000;
            });

            el.addEventListener('pointermove', (e) => {
                if (e.pointerId !== activeId) return;
                el.style.left = `${e.clientX - offsetX}px`;
                el.style.top = `${e.clientY - offsetY}px`;
            });

            const stop = (e) => {
                if (e.pointerId !== activeId) return;
                el.releasePointerCapture(e.pointerId);
                activeId = null;
                el.style.zIndex = 100;
            };

            el.addEventListener('pointerup', stop);
            el.addEventListener('pointercancel', stop);
        }

        function spawnBall() {
            const isHour = Math.random() > 0.6;
            const el = document.createElement('div');
            el.className = `falling-ball ${isHour ? 'ball-hour' : 'ball-minute'}`;
            const size = 25;
            el.style.width = el.style.height = `${size}px`;
            
            const x = Math.random() * (window.innerWidth - size);
            els.gameArea.appendChild(el);

            state.balls.push({
                el, x, y: -50,
                vy: Math.random() * 3 + 3,
                type: isHour ? 'hour' : 'minute',
                caught: false
            });
        }

        function updateBalls() {
            const hRect = els.hourJar.getBoundingClientRect();
            const mRect = els.minuteJar.getBoundingClientRect();

            for (let i = state.balls.length - 1; i >= 0; i--) {
                const b = state.balls[i];
                if (b.caught) continue;

                b.y += b.vy;
                b.el.style.transform = `translate3d(${b.x}px, ${b.y}px, 0)`;

                if (b.y > window.innerHeight) {
                    b.el.remove();
                    state.balls.splice(i, 1);
                    continue;
                }

                const rect = b.type === 'hour' ? hRect : mRect;
                if (b.x > rect.left && b.x < rect.right && b.y > rect.top && b.y < rect.bottom) {
                    catchBall(i, b.type);
                }
            }
        }

        function catchBall(index, type) {
            const b = state.balls[index];
            b.caught = true;
            b.el.classList.add('pop-anim');
            
            if (type === 'hour') state.hours = (state.hours + 1) % 24;
            else state.minutes = (state.minutes + 1) % 60;

            updateDisplay();
            
            const ball = document.createElement('div');
            ball.className = `ball ${type === 'hour' ? 'ball-hour' : 'ball-minute'}`;
            (type === 'hour' ? els.hourContent : els.minuteContent).appendChild(ball);

            setTimeout(() => b.el.remove(), 400);
            state.balls.splice(index, 1);
        }

        function updateDisplay() {
            const h = state.hours.toString().padStart(2, '0');
            const m = state.minutes.toString().padStart(2, '0');
            els.clock.textContent = `${h}:${m}`;
            els.hourCount.textContent = state.hours;
            els.minuteCount.textContent = state.minutes;
        }

        function resetGame() {
            state.hours = 0;
            state.minutes = 0;
            els.hourContent.innerHTML = '';
            els.minuteContent.innerHTML = '';
            updateDisplay();
        }

        function finishGame() {
            state.isPlaying = false;
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-time').textContent = els.clock.textContent;
        }
    </script>
</body>
</html>